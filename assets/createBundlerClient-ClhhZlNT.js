import{K as He,L as Pe,i as We,M as Ke,A as G,w as Je,N as Ze,O as Qe,n as w,P as Xe,Q as Ye,R as qe,U as et,S as tt,v as k,o as at,F as Se,T as nt,D as U,p as rt,V as Le,W as H,X as F,Y as I,Z as xe,_ as it,G as st,B as y,$ as Ce,a0 as ot,a1 as Be,a2 as ke,a3 as ct,a4 as ut,a5 as Oe,a6 as Ge,a7 as ft,a8 as dt,a9 as pt,aa as L,g as yt,k as D,y as lt,z as mt,ab as gt,ac as bt,ad as Ue,ae as ht,af as wt,ag as vt,ah as Pt,q as xt,ai as Ot,aj as Gt,ak as It,al as Et,am as Dt}from"./index-DivhlPHL.js";function ma(e,t){if(e.length!==t.length)throw new He({expectedLength:e.length,givenLength:t.length});const a=[];for(let n=0;n<e.length;n++){const r=e[n],o=t[n];a.push(Te(r,o))}return Pe(a)}function Te(e,t,a=!1){if(e==="address"){const i=t;if(!We(i))throw new Ke({address:i});return G(i.toLowerCase(),{size:a?32:null})}if(e==="string")return Je(t);if(e==="bytes")return t;if(e==="bool")return G(Ze(t),{size:a?32:1});const n=e.match(Qe);if(n){const[i,s,c="256"]=n,f=Number.parseInt(c,10)/8;return w(t,{size:a?32:f,signed:s==="int"})}const r=e.match(Xe);if(r){const[i,s]=r;if(Number.parseInt(s,10)!==(t.length-2)/2)throw new Ye({expectedSize:Number.parseInt(s,10),givenSize:(t.length-2)/2});return G(t,{dir:"right",size:a?32:null})}const o=e.match(qe);if(o&&Array.isArray(t)){const[i,s]=o,c=[];for(let f=0;f<t.length;f++)c.push(Te(s,t[f],!0));return c.length===0?"0x":Pe(c)}throw new et(e)}function St(e){const{source:t}=e,a=new Map,n=new tt(8192),r=new Map,o=({address:i,chainId:s})=>`${i}.${s}`;return{async consume({address:i,chainId:s,client:c}){const f=o({address:i,chainId:s}),d=this.get({address:i,chainId:s,client:c});this.increment({address:i,chainId:s});const g=await d;return await t.set({address:i,chainId:s},g),n.set(f,g),g},async increment({address:i,chainId:s}){const c=o({address:i,chainId:s}),f=a.get(c)??0;a.set(c,f+1)},async get({address:i,chainId:s,client:c}){const f=o({address:i,chainId:s});let d=r.get(f);return d||(d=(async()=>{try{const h=await t.get({address:i,chainId:s,client:c}),u=n.get(f)??0;return u>0&&h<=u?u+1:(n.delete(f),h)}finally{this.reset({address:i,chainId:s})}})(),r.set(f,d)),(a.get(f)??0)+await d},reset({address:i,chainId:s}){const c=o({address:i,chainId:s});a.delete(c),r.delete(c)}}}const Lt="0x6492649264926492649264926492649264926492649264926492649264926492";function J(e){const{address:t,data:a,signature:n,to:r="hex"}=e,o=Pe([k([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,a,n]),Lt]);return r==="hex"?o:at(o)}const Ut="0x5792579257925792579257925792579257925792579257925792579257925792",At=w(0,{size:32});async function Ft(e,t){async function a(d){if(d.endsWith(Ut.slice(2))){const h=rt(Le(d,-64,-32)),u=Le(d,0,-64).slice(2).match(/.{1,64}/g),v=await Promise.all(u.map(m=>At.slice(2)!==m?e.request({method:"eth_getTransactionReceipt",params:[`0x${m}`]},{dedupe:!0}):void 0)),p=v.some(m=>m===null)?100:v.every(m=>(m==null?void 0:m.status)==="0x1")?200:v.every(m=>(m==null?void 0:m.status)==="0x0")?500:600;return{atomic:!1,chainId:Se(h),receipts:v.filter(Boolean),status:p,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[d]})}const{atomic:n=!1,chainId:r,receipts:o,version:i="2.0.0",...s}=await a(t.id),[c,f]=(()=>{const d=s.status;return d>=100&&d<200?["pending",d]:d>=200&&d<300?["success",d]:d>=300&&d<700?["failure",d]:d==="CONFIRMED"?["success",200]:d==="PENDING"?["pending",100]:[void 0,d]})();return{...s,atomic:n,chainId:r?Se(r):void 0,receipts:(o==null?void 0:o.map(d=>({...d,blockNumber:U(d.blockNumber),gasUsed:U(d.gasUsed),status:nt[d.status]})))??[],statusCode:f,status:c,version:i}}async function Ct(e,t){var c;const{account:a=e.account,chainId:n,nonce:r}=t;if(!a)throw new H({docsPath:"/docs/eip7702/prepareAuthorization"});const o=F(a),i=(()=>{if(t.executor)return t.executor==="self"?t.executor:F(t.executor)})(),s={address:t.contractAddress??t.address,chainId:n,nonce:r};return typeof s.chainId>"u"&&(s.chainId=((c=e.chain)==null?void 0:c.id)??await I(e,xe,"getChainId")({})),typeof s.nonce>"u"&&(s.nonce=await I(e,it,"getTransactionCount")({address:o.address,blockTag:"pending"}),(i==="self"||i!=null&&i.address&&st(i.address,o.address))&&(s.nonce+=1)),s}class Bt extends y{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}}async function ga(e,t){const{id:a,pollingInterval:n=e.pollingInterval,status:r=({statusCode:p})=>p===200||p>=300,retryCount:o=4,retryDelay:i=({count:p})=>~~(1<<p)*200,timeout:s=6e4,throwOnFailure:c=!1}=t,f=Ce(["waitForCallsStatus",e.uid,a]),{promise:d,resolve:g,reject:h}=ot();let u;const v=Be(f,{resolve:g,reject:h},p=>{const m=ke(async()=>{const O=l=>{clearTimeout(u),m(),l(),v()};try{const l=await ct(async()=>{const P=await I(e,Ft,"getCallsStatus")({id:a});if(c&&P.status==="failure")throw new Bt(P);return P},{retryCount:o,delay:i});if(!r(l))return;O(()=>p.resolve(l))}catch(l){O(()=>p.reject(l))}},{interval:n,emitOnBegin:!0});return m});return u=s?setTimeout(()=>{v(),clearTimeout(u),h(new kt({id:a}))},s):void 0,await d}class kt extends y{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function ba(e){const{r:t,s:a}=ut.Signature.fromCompact(e.slice(2,130)),n=+`0x${e.slice(130)}`,[r,o]=(()=>{if(n===0||n===1)return[void 0,n];if(n===27)return[BigInt(n),0];if(n===28)return[BigInt(n),1];throw new Error("Invalid yParityOrV value")})();return typeof r<"u"?{r:w(t,{size:32}),s:w(a,{size:32}),v:r,yParity:o}:{r:w(t,{size:32}),s:w(a,{size:32}),yParity:o}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const je=Ge(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Tt=je.create(BigInt("-3")),jt=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Mt=Oe({a:Tt,b:jt,Fp:je,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},ft),Me=Ge(BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff")),Rt=Me.create(BigInt("-3")),Vt=BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef");Oe({a:Rt,b:Vt,Fp:Me,n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),h:BigInt(1),lowS:!1},dt);const Re=Ge(BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")),zt=Re.create(BigInt("-3")),Nt=BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00");Oe({a:zt,b:Nt,Fp:Re,n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650"),h:BigInt(1),lowS:!1,allowedPrivateKeyLengths:[130,131,132]},pt);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ha=Mt;function _t(e,t){let a;try{a=e()}catch{return}return{getItem:r=>{var o;const i=c=>c===null?null:JSON.parse(c,void 0),s=(o=a.getItem(r))!=null?o:null;return s instanceof Promise?s.then(i):i(s)},setItem:(r,o)=>a.setItem(r,JSON.stringify(o,void 0)),removeItem:r=>a.removeItem(r)}}const Q=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then(n){return Q(n)(a)},catch(n){return this}}}catch(a){return{then(n){return this},catch(n){return Q(n)(a)}}}},$t=(e,t)=>(a,n,r)=>{let o={storage:_t(()=>localStorage),partialize:p=>p,version:0,merge:(p,m)=>({...m,...p}),...t},i=!1;const s=new Set,c=new Set;let f=o.storage;if(!f)return e((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),a(...p)},n,r);const d=()=>{const p=o.partialize({...n()});return f.setItem(o.name,{state:p,version:o.version})},g=r.setState;r.setState=(p,m)=>{g(p,m),d()};const h=e((...p)=>{a(...p),d()},n,r);r.getInitialState=()=>h;let u;const v=()=>{var p,m;if(!f)return;i=!1,s.forEach(l=>{var P;return l((P=n())!=null?P:h)});const O=((m=o.onRehydrateStorage)==null?void 0:m.call(o,(p=n())!=null?p:h))||void 0;return Q(f.getItem.bind(f))(o.name).then(l=>{if(l)if(typeof l.version=="number"&&l.version!==o.version){if(o.migrate){const P=o.migrate(l.state,l.version);return P instanceof Promise?P.then(E=>[!0,E]):[!0,P]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,l.state];return[!1,void 0]}).then(l=>{var P;const[E,C]=l;if(u=o.merge(C,(P=n())!=null?P:h),a(u,!0),E)return d()}).then(()=>{O==null||O(u,void 0),u=n(),i=!0,c.forEach(l=>l(u))}).catch(l=>{O==null||O(void 0,l)})};return r.persist={setOptions:p=>{o={...o,...p},p.storage&&(f=p.storage)},clearStorage:()=>{f==null||f.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>v(),hasHydrated:()=>i,onHydrate:p=>(s.add(p),()=>{s.delete(p)}),onFinishHydration:p=>(c.add(p),()=>{c.delete(p)})},o.skipHydration||v(),u||h},wa=$t,Ae=e=>{let t;const a=new Set,n=(f,d)=>{const g=typeof f=="function"?f(t):f;if(!Object.is(g,t)){const h=t;t=d??(typeof g!="object"||g===null)?g:Object.assign({},t,g),a.forEach(u=>u(t,h))}},r=()=>t,s={setState:n,getState:r,getInitialState:()=>c,subscribe:f=>(a.add(f),()=>a.delete(f))},c=t=e(n,r,s);return s},va=e=>e?Ae(e):Ae;function W(e){return new Promise((t,a)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>a(e.error)})}function Ht(e,t){const a=indexedDB.open(e);a.onupgradeneeded=()=>a.result.createObjectStore(t);const n=W(a);return(r,o)=>n.then(i=>o(i.transaction(t,r).objectStore(t)))}let Z;function Ie(){return Z||(Z=Ht("keyval-store","keyval")),Z}function Pa(e,t=Ie()){return t("readonly",a=>W(a.get(e)))}function xa(e,t,a=Ie()){return a("readwrite",n=>(n.put(t,e),W(n.transaction)))}function Oa(e,t=Ie()){return t("readwrite",a=>(a.delete(e),W(a.transaction)))}const Ga=[{inputs:[{name:"preOpGas",type:"uint256"},{name:"paid",type:"uint256"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"targetSuccess",type:"bool"},{name:"targetResult",type:"bytes"}],name:"ExecutionResult",type:"error"},{inputs:[{name:"opIndex",type:"uint256"},{name:"reason",type:"string"}],name:"FailedOp",type:"error"},{inputs:[{name:"sender",type:"address"}],name:"SenderAddressResult",type:"error"},{inputs:[{name:"aggregator",type:"address"}],name:"SignatureValidationFailed",type:"error"},{inputs:[{components:[{name:"preOpGas",type:"uint256"},{name:"prefund",type:"uint256"},{name:"sigFailed",type:"bool"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"paymasterContext",type:"bytes"}],name:"returnInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"senderInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"factoryInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"paymasterInfo",type:"tuple"}],name:"ValidationResult",type:"error"},{inputs:[{components:[{name:"preOpGas",type:"uint256"},{name:"prefund",type:"uint256"},{name:"sigFailed",type:"bool"},{name:"validAfter",type:"uint48"},{name:"validUntil",type:"uint48"},{name:"paymasterContext",type:"bytes"}],name:"returnInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"senderInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"factoryInfo",type:"tuple"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"paymasterInfo",type:"tuple"},{components:[{name:"aggregator",type:"address"},{components:[{name:"stake",type:"uint256"},{name:"unstakeDelaySec",type:"uint256"}],name:"stakeInfo",type:"tuple"}],name:"aggregatorInfo",type:"tuple"}],name:"ValidationResultWithAggregation",type:"error"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!1,name:"factory",type:"address"},{indexed:!1,name:"paymaster",type:"address"}],name:"AccountDeployed",type:"event"},{anonymous:!1,inputs:[],name:"BeforeExecution",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"totalDeposit",type:"uint256"}],name:"Deposited",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"aggregator",type:"address"}],name:"SignatureAggregatorChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"totalStaked",type:"uint256"},{indexed:!1,name:"unstakeDelaySec",type:"uint256"}],name:"StakeLocked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawTime",type:"uint256"}],name:"StakeUnlocked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawAddress",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"StakeWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!0,name:"paymaster",type:"address"},{indexed:!1,name:"nonce",type:"uint256"},{indexed:!1,name:"success",type:"bool"},{indexed:!1,name:"actualGasCost",type:"uint256"},{indexed:!1,name:"actualGasUsed",type:"uint256"}],name:"UserOperationEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"userOpHash",type:"bytes32"},{indexed:!0,name:"sender",type:"address"},{indexed:!1,name:"nonce",type:"uint256"},{indexed:!1,name:"revertReason",type:"bytes"}],name:"UserOperationRevertReason",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"account",type:"address"},{indexed:!1,name:"withdrawAddress",type:"address"},{indexed:!1,name:"amount",type:"uint256"}],name:"Withdrawn",type:"event"},{inputs:[],name:"SIG_VALIDATION_FAILED",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"initCode",type:"bytes"},{name:"sender",type:"address"},{name:"paymasterAndData",type:"bytes"}],name:"_validateSenderAndPaymaster",outputs:[],stateMutability:"view",type:"function"},{inputs:[{name:"unstakeDelaySec",type:"uint32"}],name:"addStake",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{name:"account",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"account",type:"address"}],name:"depositTo",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{name:"",type:"address"}],name:"deposits",outputs:[{name:"deposit",type:"uint112"},{name:"staked",type:"bool"},{name:"stake",type:"uint112"},{name:"unstakeDelaySec",type:"uint32"},{name:"withdrawTime",type:"uint48"}],stateMutability:"view",type:"function"},{inputs:[{name:"account",type:"address"}],name:"getDepositInfo",outputs:[{components:[{name:"deposit",type:"uint112"},{name:"staked",type:"bool"},{name:"stake",type:"uint112"},{name:"unstakeDelaySec",type:"uint32"},{name:"withdrawTime",type:"uint48"}],name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{name:"sender",type:"address"},{name:"key",type:"uint192"}],name:"getNonce",outputs:[{name:"nonce",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{name:"initCode",type:"bytes"}],name:"getSenderAddress",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],name:"getUserOpHash",outputs:[{name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{components:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOps",type:"tuple[]"},{name:"aggregator",type:"address"},{name:"signature",type:"bytes"}],name:"opsPerAggregator",type:"tuple[]"},{name:"beneficiary",type:"address"}],name:"handleAggregatedOps",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"ops",type:"tuple[]"},{name:"beneficiary",type:"address"}],name:"handleOps",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"key",type:"uint192"}],name:"incrementNonce",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"callData",type:"bytes"},{components:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"paymaster",type:"address"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"}],name:"mUserOp",type:"tuple"},{name:"userOpHash",type:"bytes32"},{name:"prefund",type:"uint256"},{name:"contextOffset",type:"uint256"},{name:"preOpGas",type:"uint256"}],name:"opInfo",type:"tuple"},{name:"context",type:"bytes"}],name:"innerHandleOp",outputs:[{name:"actualGasCost",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"",type:"address"},{name:"",type:"uint192"}],name:"nonceSequenceNumber",outputs:[{name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"op",type:"tuple"},{name:"target",type:"address"},{name:"targetCallData",type:"bytes"}],name:"simulateHandleOp",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],name:"simulateValidation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unlockStake",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"withdrawAddress",type:"address"}],name:"withdrawStake",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"withdrawAddress",type:"address"},{name:"withdrawAmount",type:"uint256"}],name:"withdrawTo",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],Ia="0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789";function Ve(e){const{authorization:t,factory:a,factoryData:n}=e;if(a==="0x7702"||a==="0x7702000000000000000000000000000000000000"){if(!t)return"0x7702000000000000000000000000000000000000";const r=t.address;return L([r,n??"0x"])}return a?L([a,n??"0x"]):"0x"}function ze(e){const{callGasLimit:t,callData:a,maxPriorityFeePerGas:n,maxFeePerGas:r,paymaster:o,paymasterData:i,paymasterPostOpGasLimit:s,paymasterSignature:c,paymasterVerificationGasLimit:f,sender:d,signature:g="0x",verificationGasLimit:h}=e,u=L([G(w(h||0n),{size:16}),G(w(t||0n),{size:16})]),v=Ve(e),p=L([G(w(n||0n),{size:16}),G(w(r||0n),{size:16})]),m=e.nonce??0n,O=o?L([o,G(w(f||0n),{size:16}),G(w(s||0n),{size:16}),i||"0x",...c?[c]:[]]):"0x",l=e.preVerificationGas??0n;return{accountGasLimits:u,callData:a,initCode:v,gasFees:p,nonce:m,paymasterAndData:O,preVerificationGas:l,sender:d,signature:g}}const Wt={PackedUserOperation:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"}]};function Kt(e){const{chainId:t,entryPointAddress:a,userOperation:n}=e,r=ze(n);return{types:Wt,primaryType:"PackedUserOperation",domain:{name:"ERC4337",version:"1",chainId:t,verifyingContract:a},message:r}}function Ea(e){const{chainId:t,entryPointAddress:a,entryPointVersion:n}=e,r=e.userOperation,{authorization:o,callData:i="0x",callGasLimit:s,maxFeePerGas:c,maxPriorityFeePerGas:f,nonce:d,paymasterAndData:g="0x",preVerificationGas:h,sender:u,verificationGasLimit:v}=r;if(n==="0.8"||n==="0.9")return yt(Kt({chainId:t,entryPointAddress:a,userOperation:r}));const p=(()=>{var m,O;if(n==="0.6"){const l=(m=r.initCode)==null?void 0:m.slice(0,42),P=(O=r.initCode)==null?void 0:O.slice(42),E=Ve({authorization:o,factory:l,factoryData:P});return k([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[u,d,D(E),D(i),s,v,h,c,f,D(g)])}if(n==="0.7"){const l=ze(r);return k([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"}],[l.sender,l.nonce,D(l.initCode),D(l.callData),l.accountGasLimits,l.preVerificationGas,l.gasFees,D(l.paymasterAndData)])}throw new Error(`entryPointVersion "${n}" not supported.`)})();return D(k([{type:"bytes32"},{type:"address"},{type:"uint256"}],[D(p),a,BigInt(t)]))}async function Da(e){const{extend:t,nonceKeyManager:a=St({source:{get(){return Date.now()},set(){}}}),...n}=e;let r=!1;const o=await e.getAddress();return{...t,...n,address:o,async getFactoryArgs(){return"isDeployed"in this&&await this.isDeployed()?{factory:void 0,factoryData:void 0}:e.getFactoryArgs()},async getNonce(i){const s=(i==null?void 0:i.key)??BigInt(await a.consume({address:o,chainId:e.client.chain.id,client:e.client}));return e.getNonce?await e.getNonce({...i,key:s}):await mt(e.client,{abi:gt(["function getNonce(address, uint192) pure returns (uint256)"]),address:e.entryPoint.address,functionName:"getNonce",args:[o,s]})},async isDeployed(){return r?!0:(r=!!await I(e.client,lt,"getCode")({address:o}),r)},...e.sign?{async sign(i){const[{factory:s,factoryData:c},f]=await Promise.all([this.getFactoryArgs(),e.sign(i)]);return s&&c?J({address:s,data:c,signature:f}):f}}:{},async signMessage(i){const[{factory:s,factoryData:c},f]=await Promise.all([this.getFactoryArgs(),e.signMessage(i)]);return s&&c&&s!=="0x7702"?J({address:s,data:c,signature:f}):f},async signTypedData(i){const[{factory:s,factoryData:c},f]=await Promise.all([this.getFactoryArgs(),e.signTypedData(i)]);return s&&c&&s!=="0x7702"?J({address:s,data:c,signature:f}):f},type:"smart"}}class X extends y{constructor({cause:t}){super("Smart Account is not deployed.",{cause:t,metaMessages:["This could arise when:","- No `factory`/`factoryData` or `initCode` properties are provided for Smart Account deployment.","- An incorrect `sender` address is provided."],name:"AccountNotDeployedError"})}}Object.defineProperty(X,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa20/});class A extends y{constructor({cause:t,data:a,message:n}={}){var o;const r=(o=n==null?void 0:n.replace("execution reverted: ",""))==null?void 0:o.replace("execution reverted","");super(`Execution reverted ${r?`with reason: ${r}`:"for an unknown reason"}.`,{cause:t,name:"ExecutionRevertedError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=a}}Object.defineProperty(A,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32521});Object.defineProperty(A,"message",{enumerable:!0,configurable:!0,writable:!0,value:/execution reverted/});class Y extends y{constructor({cause:t}){super("Failed to send funds to beneficiary.",{cause:t,name:"FailedToSendToBeneficiaryError"})}}Object.defineProperty(Y,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa91/});class q extends y{constructor({cause:t}){super("Gas value overflowed.",{cause:t,metaMessages:["This could arise when:","- one of the gas values exceeded 2**120 (uint120)"].filter(Boolean),name:"GasValuesOverflowError"})}}Object.defineProperty(q,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa94/});class ee extends y{constructor({cause:t}){super("The `handleOps` function was called by the Bundler with a gas limit too low.",{cause:t,name:"HandleOpsOutOfGasError"})}}Object.defineProperty(ee,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa95/});class te extends y{constructor({cause:t,factory:a,factoryData:n,initCode:r}){super("Failed to simulate deployment for Smart Account.",{cause:t,metaMessages:["This could arise when:","- Invalid `factory`/`factoryData` or `initCode` properties are present","- Smart Account deployment execution ran out of gas (low `verificationGasLimit` value)",`- Smart Account deployment execution reverted with an error
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,r&&`initCode: ${r}`].filter(Boolean),name:"InitCodeFailedError"})}}Object.defineProperty(te,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa13/});class ae extends y{constructor({cause:t,factory:a,factoryData:n,initCode:r}){super("Smart Account initialization implementation did not create an account.",{cause:t,metaMessages:["This could arise when:","- `factory`/`factoryData` or `initCode` properties are invalid",`- Smart Account initialization implementation is incorrect
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,r&&`initCode: ${r}`].filter(Boolean),name:"InitCodeMustCreateSenderError"})}}Object.defineProperty(ae,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa15/});class ne extends y{constructor({cause:t,factory:a,factoryData:n,initCode:r,sender:o}){super("Smart Account initialization implementation does not return the expected sender.",{cause:t,metaMessages:["This could arise when:",`Smart Account initialization implementation does not return a sender address
`,a&&`factory: ${a}`,n&&`factoryData: ${n}`,r&&`initCode: ${r}`,o&&`sender: ${o}`].filter(Boolean),name:"InitCodeMustReturnSenderError"})}}Object.defineProperty(ne,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa14/});class re extends y{constructor({cause:t}){super("Smart Account does not have sufficient funds to execute the User Operation.",{cause:t,metaMessages:["This could arise when:","- the Smart Account does not have sufficient funds to cover the required prefund, or","- a Paymaster was not provided"].filter(Boolean),name:"InsufficientPrefundError"})}}Object.defineProperty(re,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa21/});class ie extends y{constructor({cause:t}){super("Bundler attempted to call an invalid function on the EntryPoint.",{cause:t,name:"InternalCallOnlyError"})}}Object.defineProperty(ie,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa92/});class se extends y{constructor({cause:t}){super("Bundler used an invalid aggregator for handling aggregated User Operations.",{cause:t,name:"InvalidAggregatorError"})}}Object.defineProperty(se,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa96/});class oe extends y{constructor({cause:t,nonce:a}){super("Invalid Smart Account nonce used for User Operation.",{cause:t,metaMessages:[a&&`nonce: ${a}`].filter(Boolean),name:"InvalidAccountNonceError"})}}Object.defineProperty(oe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa25/});class ce extends y{constructor({cause:t}){super("Bundler has not set a beneficiary address.",{cause:t,name:"InvalidBeneficiaryError"})}}Object.defineProperty(ce,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa90/});class T extends y{constructor({cause:t}){super("Invalid fields set on User Operation.",{cause:t,name:"InvalidFieldsError"})}}Object.defineProperty(T,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32602});class ue extends y{constructor({cause:t,paymasterAndData:a}){super("Paymaster properties provided are invalid.",{cause:t,metaMessages:["This could arise when:","- the `paymasterAndData` property is of an incorrect length\n",a&&`paymasterAndData: ${a}`].filter(Boolean),name:"InvalidPaymasterAndDataError"})}}Object.defineProperty(ue,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa93/});class S extends y{constructor({cause:t}){super("Paymaster deposit for the User Operation is too low.",{cause:t,metaMessages:["This could arise when:","- the Paymaster has deposited less than the expected amount via the `deposit` function"].filter(Boolean),name:"PaymasterDepositTooLowError"})}}Object.defineProperty(S,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32508});Object.defineProperty(S,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa31/});class fe extends y{constructor({cause:t}){super("The `validatePaymasterUserOp` function on the Paymaster reverted.",{cause:t,name:"PaymasterFunctionRevertedError"})}}Object.defineProperty(fe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa33/});class de extends y{constructor({cause:t}){super("The Paymaster contract has not been deployed.",{cause:t,name:"PaymasterNotDeployedError"})}}Object.defineProperty(de,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa30/});class j extends y{constructor({cause:t}){super("UserOperation rejected because paymaster (or signature aggregator) is throttled/banned.",{cause:t,name:"PaymasterRateLimitError"})}}Object.defineProperty(j,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32504});class M extends y{constructor({cause:t}){super("UserOperation rejected because paymaster (or signature aggregator) is throttled/banned.",{cause:t,name:"PaymasterStakeTooLowError"})}}Object.defineProperty(M,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32505});class pe extends y{constructor({cause:t}){super("Paymaster `postOp` function reverted.",{cause:t,name:"PaymasterPostOpFunctionRevertedError"})}}Object.defineProperty(pe,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa50/});class ye extends y{constructor({cause:t,factory:a,factoryData:n,initCode:r}){super("Smart Account has already been deployed.",{cause:t,metaMessages:["Remove the following properties and try again:",a&&"`factory`",n&&"`factoryData`",r&&"`initCode`"].filter(Boolean),name:"SenderAlreadyConstructedError"})}}Object.defineProperty(ye,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa10/});class R extends y{constructor({cause:t}){super("UserOperation rejected because account signature check failed (or paymaster signature, if the paymaster uses its data as signature).",{cause:t,name:"SignatureCheckFailedError"})}}Object.defineProperty(R,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32507});class le extends y{constructor({cause:t}){super("The `validateUserOp` function on the Smart Account reverted.",{cause:t,name:"SmartAccountFunctionRevertedError"})}}Object.defineProperty(le,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa23/});class V extends y{constructor({cause:t}){super("UserOperation rejected because account specified unsupported signature aggregator.",{cause:t,name:"UnsupportedSignatureAggregatorError"})}}Object.defineProperty(V,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32506});class me extends y{constructor({cause:t}){super("User Operation expired.",{cause:t,metaMessages:["This could arise when:","- the `validAfter` or `validUntil` values returned from `validateUserOp` on the Smart Account are not satisfied"].filter(Boolean),name:"UserOperationExpiredError"})}}Object.defineProperty(me,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa22/});class ge extends y{constructor({cause:t}){super("Paymaster for User Operation expired.",{cause:t,metaMessages:["This could arise when:","- the `validAfter` or `validUntil` values returned from `validatePaymasterUserOp` on the Paymaster are not satisfied"].filter(Boolean),name:"UserOperationPaymasterExpiredError"})}}Object.defineProperty(ge,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa32/});class be extends y{constructor({cause:t}){super("Signature provided for the User Operation is invalid.",{cause:t,metaMessages:["This could arise when:","- the `signature` for the User Operation is incorrectly computed, and unable to be verified by the Smart Account"].filter(Boolean),name:"UserOperationSignatureError"})}}Object.defineProperty(be,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa24/});class he extends y{constructor({cause:t}){super("Signature provided for the User Operation is invalid.",{cause:t,metaMessages:["This could arise when:","- the `signature` for the User Operation is incorrectly computed, and unable to be verified by the Paymaster"].filter(Boolean),name:"UserOperationPaymasterSignatureError"})}}Object.defineProperty(he,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa34/});class z extends y{constructor({cause:t}){super("User Operation rejected by EntryPoint's `simulateValidation` during account creation or validation.",{cause:t,name:"UserOperationRejectedByEntryPointError"})}}Object.defineProperty(z,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32500});class N extends y{constructor({cause:t}){super("User Operation rejected by Paymaster's `validatePaymasterUserOp`.",{cause:t,name:"UserOperationRejectedByPaymasterError"})}}Object.defineProperty(N,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32501});class _ extends y{constructor({cause:t}){super("User Operation rejected with op code validation error.",{cause:t,name:"UserOperationRejectedByOpCodeError"})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32502});class $ extends y{constructor({cause:t}){super("UserOperation out of time-range: either wallet or paymaster returned a time-range, and it is already expired (or will expire soon).",{cause:t,name:"UserOperationOutOfTimeRangeError"})}}Object.defineProperty($,"code",{enumerable:!0,configurable:!0,writable:!0,value:-32503});class Jt extends y{constructor({cause:t}){super(`An error occurred while executing user operation: ${t==null?void 0:t.shortMessage}`,{cause:t,name:"UnknownBundlerError"})}}class we extends y{constructor({cause:t}){super("User Operation verification gas limit exceeded.",{cause:t,metaMessages:["This could arise when:","- the gas used for verification exceeded the `verificationGasLimit`"].filter(Boolean),name:"VerificationGasLimitExceededError"})}}Object.defineProperty(we,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa40/});class ve extends y{constructor({cause:t}){super("User Operation verification gas limit is too low.",{cause:t,metaMessages:["This could arise when:","- the `verificationGasLimit` is too low to verify the User Operation"].filter(Boolean),name:"VerificationGasLimitTooLowError"})}}Object.defineProperty(ve,"message",{enumerable:!0,configurable:!0,writable:!0,value:/aa41/});class Zt extends y{constructor(t,{callData:a,callGasLimit:n,docsPath:r,factory:o,factoryData:i,initCode:s,maxFeePerGas:c,maxPriorityFeePerGas:f,nonce:d,paymaster:g,paymasterAndData:h,paymasterData:u,paymasterPostOpGasLimit:v,paymasterVerificationGasLimit:p,preVerificationGas:m,sender:O,signature:l,verificationGasLimit:P}){const E=bt({callData:a,callGasLimit:n,factory:o,factoryData:i,initCode:s,maxFeePerGas:typeof c<"u"&&`${Ue(c)} gwei`,maxPriorityFeePerGas:typeof f<"u"&&`${Ue(f)} gwei`,nonce:d,paymaster:g,paymasterAndData:h,paymasterData:u,paymasterPostOpGasLimit:v,paymasterVerificationGasLimit:p,preVerificationGas:m,sender:O,signature:l,verificationGasLimit:P});super(t.shortMessage,{cause:t,docsPath:r,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Request Arguments:",E].filter(Boolean),name:"UserOperationExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}}class Qt extends y{constructor({hash:t}){super(`User Operation receipt with hash "${t}" could not be found. The User Operation may not have been processed yet.`,{name:"UserOperationReceiptNotFoundError"})}}class Xt extends y{constructor({hash:t}){super(`User Operation with hash "${t}" could not be found.`,{name:"UserOperationNotFoundError"})}}class Fe extends y{constructor({hash:t}){super(`Timed out while waiting for User Operation with hash "${t}" to be confirmed.`,{name:"WaitForUserOperationReceiptTimeoutError"})}}const Yt=[A,T,S,j,M,R,V,$,z,N,_];function qt(e,t){const a=(e.details||"").toLowerCase();if(X.message.test(a))return new X({cause:e});if(Y.message.test(a))return new Y({cause:e});if(q.message.test(a))return new q({cause:e});if(ee.message.test(a))return new ee({cause:e});if(te.message.test(a))return new te({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(ae.message.test(a))return new ae({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(ne.message.test(a))return new ne({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode,sender:t.sender});if(re.message.test(a))return new re({cause:e});if(ie.message.test(a))return new ie({cause:e});if(oe.message.test(a))return new oe({cause:e,nonce:t.nonce});if(se.message.test(a))return new se({cause:e});if(ce.message.test(a))return new ce({cause:e});if(ue.message.test(a))return new ue({cause:e});if(S.message.test(a))return new S({cause:e});if(fe.message.test(a))return new fe({cause:e});if(de.message.test(a))return new de({cause:e});if(pe.message.test(a))return new pe({cause:e});if(le.message.test(a))return new le({cause:e});if(ye.message.test(a))return new ye({cause:e,factory:t.factory,factoryData:t.factoryData,initCode:t.initCode});if(me.message.test(a))return new me({cause:e});if(ge.message.test(a))return new ge({cause:e});if(he.message.test(a))return new he({cause:e});if(be.message.test(a))return new be({cause:e});if(we.message.test(a))return new we({cause:e});if(ve.message.test(a))return new ve({cause:e});const n=e.walk(r=>Yt.some(o=>o.code===r.code));if(n){if(n.code===A.code)return new A({cause:e,data:n.data,message:n.details});if(n.code===T.code)return new T({cause:e});if(n.code===S.code)return new S({cause:e});if(n.code===j.code)return new j({cause:e});if(n.code===M.code)return new M({cause:e});if(n.code===R.code)return new R({cause:e});if(n.code===V.code)return new V({cause:e});if(n.code===$.code)return new $({cause:e});if(n.code===z.code)return new z({cause:e});if(n.code===N.code)return new N({cause:e});if(n.code===_.code)return new _({cause:e})}return new Jt({cause:e})}function Ne(e,{calls:t,docsPath:a,...n}){const r=(()=>{const o=qt(e,n);if(t&&o instanceof A){const i=ea(o),s=t==null?void 0:t.filter(c=>c.abi);if(i&&s.length>0)return ta({calls:s,revertData:i})}return o})();return new Zt(r,{docsPath:a,...n})}function ea(e){let t;return e.walk(a=>{var r,o,i,s;const n=a;if(typeof n.data=="string"||typeof((r=n.data)==null?void 0:r.revertData)=="string"||!(n instanceof y)&&typeof n.message=="string"){const c=(s=(i=((o=n.data)==null?void 0:o.revertData)||n.data||n.message).match)==null?void 0:s.call(i,/(0x[A-Za-z0-9]*)/);if(c)return t=c[1],!0}return!1}),t}function ta(e){const{calls:t,revertData:a}=e,{abi:n,functionName:r,args:o,to:i}=(()=>{const c=t==null?void 0:t.filter(d=>!!d.abi);if(c.length===1)return c[0];const f=c.filter(d=>{try{return!!ht({abi:d.abi,data:a})}catch{return!1}});return f.length===1?f[0]:{abi:[],functionName:c.reduce((d,g)=>`${d?`${d} | `:""}${g.functionName}`,""),args:void 0,to:void 0}})(),s=a==="0x"?new wt({functionName:r}):new vt({abi:n,data:a,functionName:r});return new Pt(s,{abi:n,args:o,contractAddress:i,functionName:r})}function aa(e){const t={};return e.callGasLimit&&(t.callGasLimit=BigInt(e.callGasLimit)),e.preVerificationGas&&(t.preVerificationGas=BigInt(e.preVerificationGas)),e.verificationGasLimit&&(t.verificationGasLimit=BigInt(e.verificationGasLimit)),e.paymasterPostOpGasLimit&&(t.paymasterPostOpGasLimit=BigInt(e.paymasterPostOpGasLimit)),e.paymasterVerificationGasLimit&&(t.paymasterVerificationGasLimit=BigInt(e.paymasterVerificationGasLimit)),t}function K(e){const t={};return typeof e.callData<"u"&&(t.callData=e.callData),typeof e.callGasLimit<"u"&&(t.callGasLimit=w(e.callGasLimit)),typeof e.factory<"u"&&(t.factory=e.factory),typeof e.factoryData<"u"&&(t.factoryData=e.factoryData),typeof e.initCode<"u"&&(t.initCode=e.initCode),typeof e.maxFeePerGas<"u"&&(t.maxFeePerGas=w(e.maxFeePerGas)),typeof e.maxPriorityFeePerGas<"u"&&(t.maxPriorityFeePerGas=w(e.maxPriorityFeePerGas)),typeof e.nonce<"u"&&(t.nonce=w(e.nonce)),typeof e.paymaster<"u"&&(t.paymaster=e.paymaster),typeof e.paymasterAndData<"u"&&(t.paymasterAndData=e.paymasterAndData||"0x"),typeof e.paymasterData<"u"&&(t.paymasterData=e.paymasterData),typeof e.paymasterPostOpGasLimit<"u"&&(t.paymasterPostOpGasLimit=w(e.paymasterPostOpGasLimit)),typeof e.paymasterSignature<"u"&&(t.paymasterSignature=e.paymasterSignature),typeof e.paymasterVerificationGasLimit<"u"&&(t.paymasterVerificationGasLimit=w(e.paymasterVerificationGasLimit)),typeof e.preVerificationGas<"u"&&(t.preVerificationGas=w(e.preVerificationGas)),typeof e.sender<"u"&&(t.sender=e.sender),typeof e.signature<"u"&&(t.signature=e.signature),typeof e.verificationGasLimit<"u"&&(t.verificationGasLimit=w(e.verificationGasLimit)),typeof e.authorization<"u"&&(t.eip7702Auth=na(e.authorization)),t}function na(e){return{address:e.address,chainId:w(e.chainId),nonce:w(e.nonce),r:e.r?w(BigInt(e.r),{size:32}):G("0x",{size:32}),s:e.s?w(BigInt(e.s),{size:32}):G("0x",{size:32}),yParity:e.yParity?w(e.yParity,{size:1}):G("0x",{size:32})}}async function ra(e,t){const{chainId:a,entryPointAddress:n,context:r,...o}=t,i=K(o),{paymasterPostOpGasLimit:s,paymasterVerificationGasLimit:c,...f}=await e.request({method:"pm_getPaymasterData",params:[{...i,callGasLimit:i.callGasLimit??"0x0",verificationGasLimit:i.verificationGasLimit??"0x0",preVerificationGas:i.preVerificationGas??"0x0"},n,w(a),r]});return{...f,...s&&{paymasterPostOpGasLimit:U(s)},...c&&{paymasterVerificationGasLimit:U(c)}}}async function ia(e,t){const{chainId:a,entryPointAddress:n,context:r,...o}=t,i=K(o),{paymasterPostOpGasLimit:s,paymasterVerificationGasLimit:c,...f}=await e.request({method:"pm_getPaymasterStubData",params:[{...i,callGasLimit:i.callGasLimit??"0x0",verificationGasLimit:i.verificationGasLimit??"0x0",preVerificationGas:i.preVerificationGas??"0x0"},n,w(a),r]});return{...f,...s&&{paymasterPostOpGasLimit:U(s)},...c&&{paymasterVerificationGasLimit:U(c)}}}const sa=["factory","fees","gas","paymaster","nonce","signature","authorization"];async function Ee(e,t){var De;const a=t,{account:n=e.account,parameters:r=sa,stateOverride:o}=a;if(!n)throw new H;const i=F(n),s=e,c=a.paymaster??(s==null?void 0:s.paymaster),f=typeof c=="string"?c:void 0,{getPaymasterStubData:d,getPaymasterData:g}=(()=>{if(c===!0)return{getPaymasterStubData:b=>I(s,ia,"getPaymasterStubData")(b),getPaymasterData:b=>I(s,ra,"getPaymasterData")(b)};if(typeof c=="object"){const{getPaymasterStubData:b,getPaymasterData:x}=c;return{getPaymasterStubData:x&&b?b:x,getPaymasterData:x&&b?x:void 0}}return{getPaymasterStubData:void 0,getPaymasterData:void 0}})(),h=a.paymasterContext?a.paymasterContext:s==null?void 0:s.paymasterContext;let u={...a,paymaster:f,sender:i.address};const[v,p,m,O,l]=await Promise.all([(async()=>a.calls?i.encodeCalls(a.calls.map(b=>{const x=b;return x.abi?{data:xt(x),to:x.to,value:x.value}:x})):a.callData)(),(async()=>{if(!r.includes("factory"))return;if(a.initCode)return{initCode:a.initCode};if(a.factory&&a.factoryData)return{factory:a.factory,factoryData:a.factoryData};const{factory:b,factoryData:x}=await i.getFactoryArgs();return i.entryPoint.version==="0.6"?{initCode:b&&x?L([b,x]):void 0}:{factory:b,factoryData:x}})(),(async()=>{var b;if(r.includes("fees")){if(typeof a.maxFeePerGas=="bigint"&&typeof a.maxPriorityFeePerGas=="bigint")return u;if((b=s==null?void 0:s.userOperation)!=null&&b.estimateFeesPerGas){const x=await s.userOperation.estimateFeesPerGas({account:i,bundlerClient:s,userOperation:u});return{...u,...x}}try{const x=s.client??e,B=await I(x,Ot,"estimateFeesPerGas")({chain:x.chain,type:"eip1559"});return{maxFeePerGas:typeof a.maxFeePerGas=="bigint"?a.maxFeePerGas:BigInt(2n*B.maxFeePerGas),maxPriorityFeePerGas:typeof a.maxPriorityFeePerGas=="bigint"?a.maxPriorityFeePerGas:BigInt(2n*B.maxPriorityFeePerGas)}}catch{return}}})(),(async()=>{if(r.includes("nonce"))return typeof a.nonce=="bigint"?a.nonce:i.getNonce()})(),(async()=>{if(r.includes("authorization")){if(typeof a.authorization=="object")return a.authorization;if(i.authorization&&!await i.isDeployed())return{...await Ct(i.client,i.authorization),r:"0xfffffffffffffffffffffffffffffff000000000000000000000000000000000",s:"0x7aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",yParity:1}}})()]);typeof v<"u"&&(u.callData=v),typeof p<"u"&&(u={...u,...p}),typeof m<"u"&&(u={...u,...m}),typeof O<"u"&&(u.nonce=O),typeof l<"u"&&(u.authorization=l),r.includes("signature")&&(typeof a.signature<"u"?u.signature=a.signature:u.signature=await i.getStubSignature(u)),i.entryPoint.version==="0.6"&&!u.initCode&&(u.initCode="0x");let P;async function E(){return P||(e.chain?e.chain.id:(P=await I(e,xe,"getChainId")({}),P))}let C=!1;if(r.includes("paymaster")&&d&&!f&&!a.paymasterAndData){const{isFinal:b=!1,sponsor:x,...B}=await d({chainId:await E(),entryPointAddress:i.entryPoint.address,context:h,...u});C=b,u={...u,...B}}if(i.entryPoint.version==="0.6"&&!u.paymasterAndData&&(u.paymasterAndData="0x"),r.includes("gas")){if((De=i.userOperation)!=null&&De.estimateGas){const b=await i.userOperation.estimateGas(u);u={...u,...b}}if(typeof u.callGasLimit>"u"||typeof u.preVerificationGas>"u"||typeof u.verificationGasLimit>"u"||u.paymaster&&typeof u.paymasterPostOpGasLimit>"u"||u.paymaster&&typeof u.paymasterVerificationGasLimit>"u"){const b=await I(s,_e,"estimateUserOperationGas")({account:i,callGasLimit:0n,preVerificationGas:0n,verificationGasLimit:0n,stateOverride:o,...u.paymaster?{paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n}:{},...u});u={...u,callGasLimit:u.callGasLimit??b.callGasLimit,preVerificationGas:u.preVerificationGas??b.preVerificationGas,verificationGasLimit:u.verificationGasLimit??b.verificationGasLimit,paymasterPostOpGasLimit:u.paymasterPostOpGasLimit??b.paymasterPostOpGasLimit,paymasterVerificationGasLimit:u.paymasterVerificationGasLimit??b.paymasterVerificationGasLimit}}}if(r.includes("paymaster")&&g&&!f&&!a.paymasterAndData&&!C){const b=await g({chainId:await E(),entryPointAddress:i.entryPoint.address,context:h,...u});u={...u,...b}}return delete u.calls,delete u.parameters,delete u.paymasterContext,typeof u.paymaster!="string"&&delete u.paymaster,u}async function _e(e,t){var c;const{account:a=e.account,entryPointAddress:n,stateOverride:r}=t;if(!a&&!t.sender)throw new H;const o=a?F(a):void 0,i=Gt(r),s=o?await I(e,Ee,"prepareUserOperation")({...t,parameters:["authorization","factory","nonce","paymaster","signature"]}):t;try{const f=[K(s),n??((c=o==null?void 0:o.entryPoint)==null?void 0:c.address)],d=await e.request({method:"eth_estimateUserOperationGas",params:i?[...f,i]:[...f]});return aa(d)}catch(f){const d=t.calls;throw Ne(f,{...s,...d?{calls:d}:{}})}}function oa(e){return e.request({method:"eth_supportedEntryPoints"})}function ca(e){const t={...e};return e.callGasLimit&&(t.callGasLimit=BigInt(e.callGasLimit)),e.maxFeePerGas&&(t.maxFeePerGas=BigInt(e.maxFeePerGas)),e.maxPriorityFeePerGas&&(t.maxPriorityFeePerGas=BigInt(e.maxPriorityFeePerGas)),e.nonce&&(t.nonce=BigInt(e.nonce)),e.paymasterPostOpGasLimit&&(t.paymasterPostOpGasLimit=BigInt(e.paymasterPostOpGasLimit)),e.paymasterVerificationGasLimit&&(t.paymasterVerificationGasLimit=BigInt(e.paymasterVerificationGasLimit)),e.preVerificationGas&&(t.preVerificationGas=BigInt(e.preVerificationGas)),e.verificationGasLimit&&(t.verificationGasLimit=BigInt(e.verificationGasLimit)),t}async function ua(e,{hash:t}){const a=await e.request({method:"eth_getUserOperationByHash",params:[t]},{dedupe:!0});if(!a)throw new Xt({hash:t});const{blockHash:n,blockNumber:r,entryPoint:o,transactionHash:i,userOperation:s}=a;return{blockHash:n,blockNumber:BigInt(r),entryPoint:o,transactionHash:i,userOperation:ca(s)}}function fa(e){const t={...e};return e.actualGasCost&&(t.actualGasCost=BigInt(e.actualGasCost)),e.actualGasUsed&&(t.actualGasUsed=BigInt(e.actualGasUsed)),e.logs&&(t.logs=e.logs.map(a=>It(a))),e.receipt&&(t.receipt=Et(t.receipt)),t}async function $e(e,{hash:t}){const a=await e.request({method:"eth_getUserOperationReceipt",params:[t]},{dedupe:!0});if(!a)throw new Qt({hash:t});return fa(a)}async function da(e,t){var c,f;const{account:a=e.account,entryPointAddress:n}=t;if(!a&&!t.sender)throw new H;const r=a?F(a):void 0,o=r?await I(e,Ee,"prepareUserOperation")(t):t,i=t.signature||await((c=r==null?void 0:r.signUserOperation)==null?void 0:c.call(r,o)),s=K({...o,signature:i});try{return await e.request({method:"eth_sendUserOperation",params:[s,n??((f=r==null?void 0:r.entryPoint)==null?void 0:f.address)]},{retryCount:0})}catch(d){const g=t.calls;throw Ne(d,{...o,...g?{calls:g}:{},signature:i})}}function pa(e,t){const{hash:a,pollingInterval:n=e.pollingInterval,retryCount:r,timeout:o=12e4}=t;let i=0;const s=Ce(["waitForUserOperationReceipt",e.uid,a]);return new Promise((c,f)=>{const d=Be(s,{resolve:c,reject:f},g=>{const h=p=>{v(),p(),d()},u=o?setTimeout(()=>h(()=>g.reject(new Fe({hash:a}))),o):void 0,v=ke(async()=>{r&&i>=r&&(clearTimeout(u),h(()=>g.reject(new Fe({hash:a}))));try{const p=await I(e,$e,"getUserOperationReceipt")({hash:a});clearTimeout(u),h(()=>g.resolve(p))}catch(p){const m=p;m.name!=="UserOperationReceiptNotFoundError"&&(clearTimeout(u),h(()=>g.reject(m)))}i++},{emitOnBegin:!0,interval:n});return v})})}function ya(e){return{estimateUserOperationGas:t=>_e(e,t),getChainId:()=>xe(e),getSupportedEntryPoints:()=>oa(e),getUserOperation:t=>ua(e,t),getUserOperationReceipt:t=>$e(e,t),prepareUserOperation:t=>Ee(e,t),sendUserOperation:t=>da(e,t),waitForUserOperationReceipt:t=>pa(e,t)}}function Sa(e){const{client:t,key:a="bundler",name:n="Bundler Client",paymaster:r,paymasterContext:o,transport:i,userOperation:s}=e;return Object.assign(Dt({...e,chain:e.chain??(t==null?void 0:t.chain),key:a,name:n,transport:i,type:"bundlerClient"}),{client:t,paymaster:r,paymasterContext:o,userOperation:s}).extend(ya)}export{_t as a,Sa as b,va as c,ha as d,Ht as e,Oa as f,Pa as g,Ia as h,Ga as i,Ea as j,ba as k,ma as l,wa as p,xa as s,Da as t,ga as w};
